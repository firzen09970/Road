<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€€ä¼æ—…è²»è¨ˆç®—æ©Ÿ (GMapsé©—è­‰ç‰ˆ)</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet">

    <style>
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; padding: 20px; max-width: 900px; margin: 0 auto; background-color: #f0f2f5; }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        h2 { color: #2c3e50; margin-top: 0; border-bottom: 4px solid #198754; padding-bottom: 10px; font-weight: 800; display: flex; align-items: center; }
        h2::before { content: 'ğŸª–'; margin-right: 10px; font-size: 1.2em; }

        .control-panel { background: #eef2f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; position: relative; z-index: 1000; }
        
        .form-group { margin-bottom: 15px; }
        label { font-weight: bold; display: block; margin-bottom: 8px; color: #495057; font-size: 1.1em; }
        
        .origin-box {
            background: #fff; border: 2px solid #6c757d; color: #495057;
            padding: 10px 15px; border-radius: 6px; font-weight: bold; font-size: 1.1em;
            display: flex; align-items: center;
        }
        .origin-icon { margin-right: 10px; font-size: 1.4em; }

        .ts-control { border-radius: 6px !important; padding: 12px !important; font-size: 16px !important; border: 1px solid #ced4da; }

        /* è¨ˆç®—æŒ‰éˆ• */
        .btn-calc { 
            width: 100%; padding: 14px; background-color: #198754; color: white; 
            border: none; font-size: 18px; font-weight: bold; border-radius: 6px; 
            cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px rgba(25, 135, 84, 0.2);
        }
        .btn-calc:hover { background-color: #157347; transform: translateY(-1px); }
        
        /* Google Maps æŒ‰éˆ• */
        .btn-gmaps {
            display: block; width: 100%; text-decoration: none; text-align: center;
            background-color: #4285F4; color: white; padding: 12px; border-radius: 6px;
            font-weight: bold; margin-top: 15px; box-shadow: 0 2px 5px rgba(66, 133, 244, 0.3);
            transition: background 0.2s;
        }
        .btn-gmaps:hover { background-color: #3367D6; color: white; }

        /* çµæœå¡ç‰‡ */
        #result-card {
            background-color: #fff; border: 1px solid #ddd;
            padding: 0; border-radius: 8px; margin-top: 20px; display: none;
            overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .result-header { background: #f8f9fa; padding: 15px; border-bottom: 1px solid #eee; }
        .result-body { padding: 15px; }
        .result-row { margin-bottom: 8px; font-size: 1.1em; line-height: 1.5; }
        .result-label { font-weight: bold; color: #555; display: inline-block; min-width: 80px; }
        .result-address { font-size: 0.95em; color: #666; display: block; margin-left: 0; margin-top: 2px;}
        .highlight-dist { color: #0d6efd; font-weight: 900; font-size: 1.2em; }

        /* é‡‘é¡å€å¡Š */
        .money-box {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #198754; color: #155724; padding: 15px;
            border-radius: 8px; margin-top: 15px; text-align: center;
        }
        .money-amount { font-size: 2.5em; font-weight: 900; line-height: 1.1; color: #dc3545; }
        .money-note { font-size: 0.85em; margin-top: 5px; color: #555; }

        #map { height: 400px; width: 100%; border-radius: 8px; margin-top: 20px; border: 1px solid #ddd; z-index: 1;}
        .note { font-size: 0.85em; color: #888; margin-top: 15px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h2>é€€ä¼æ—…è²»è¨ˆç®—æ©Ÿ</h2>
    
    <div class="control-panel">
        <div class="form-group">
            <label>ğŸ ç‡Ÿå€å‡ºç™¼åœ° (å›ºå®š)ï¼š</label>
            <div class="origin-box">
                <span class="origin-icon">ğŸ“</span> 
                842é«˜é›„å¸‚æ——å±±å€æ——å—ä¸‰è·¯234è™Ÿ
            </div>
        </div>
        
        <div class="form-group">
            <label for="district-select">ğŸ  æˆ¶ç±åœ° (å€å…¬æ‰€)ï¼š</label>
            <select id="district-select" placeholder="è«‹è¼¸å…¥å€å (ä¾‹å¦‚: æ°¸åº·)..." autocomplete="off">
                <option value="">è¼¸å…¥é—œéµå­—æœå°‹ (å¦‚: æ°¸åº·, ä¿¡ç¾©)...</option>
            </select>
        </div>
        
        <button class="btn-calc" onclick="calculateRoute()">ğŸ’µ é ç®—èˆ‡è·¯å¾‘</button>

        <div id="result-card">
            <div id="result-content"></div>
        </div>
        
        <div class="note">* é ç®—åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›è·é›¢è«‹ä»¥ Google Maps ç‚ºæº–ã€‚<br>* è·é›¢ â‰¥ 60km ç™¼ 600å…ƒï¼Œ< 60km ç™¼ 200å…ƒã€‚</div>
    </div>

    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>

<script>
    // --- 1. è³‡æ–™åº« ---
    const districtData = {
        "è‡ºå—å¸‚": [
            { name: "æ°¸åº·å€å…¬æ‰€", addr: "710è‡ºå—å¸‚æ°¸åº·å€ä¸­å±±å—è·¯655è™Ÿ", lat: 23.0261, lng: 120.2563 },
            { name: "ä¸­è¥¿å€å…¬æ‰€", addr: "700è‡ºå—å¸‚ä¸­è¥¿å€é–‹å±±è·¯1è™Ÿ", lat: 22.9893, lng: 120.2086 },
            { name: "æ±å€å€å…¬æ‰€", addr: "701è‡ºå—å¸‚æ±å€å´‡å­¸è·¯100è™Ÿ", lat: 22.9806, lng: 120.2244 },
            { name: "å—å€å€å…¬æ‰€", addr: "702è‡ºå—å¸‚å—å€æ˜èˆˆè·¯2è™Ÿ", lat: 22.9613, lng: 120.1917 },
            { name: "åŒ—å€å€å…¬æ‰€", addr: "704è‡ºå—å¸‚åŒ—å€æˆåŠŸè·¯238å··7è™Ÿ", lat: 22.9997, lng: 120.2016 },
            { name: "å®‰å¹³å€å…¬æ‰€", addr: "708è‡ºå—å¸‚å®‰å¹³å€è‚²å¹³è·¯316è™Ÿ", lat: 22.9934, lng: 120.1706 },
            { name: "å®‰å—å€å…¬æ‰€", addr: "709è‡ºå—å¸‚å®‰å—å€å®‰ä¸­è·¯äºŒæ®µ308è™Ÿ", lat: 23.0471, lng: 120.1834 },
            { name: "æ­¸ä»å€å…¬æ‰€", addr: "711è‡ºå—å¸‚æ­¸ä»å€ä¸­æ­£å—è·¯ä¸€æ®µ1213è™Ÿ", lat: 22.9680, lng: 120.2942 },
            { name: "æ–°åŒ–å€å…¬æ‰€", addr: "712è‡ºå—å¸‚æ–°åŒ–å€ä¸­å±±è·¯130è™Ÿ", lat: 23.0371, lng: 120.3060 },
            { name: "ä»å¾·å€å…¬æ‰€", addr: "717è‡ºå—å¸‚ä»å¾·å€ä¸­æ­£è·¯ä¸‰æ®µ5è™Ÿ", lat: 22.9719, lng: 120.2505 },
            { name: "é—œå»Ÿå€å…¬æ‰€", addr: "718è‡ºå—å¸‚é—œå»Ÿå€ä¸­æ­£è·¯998è™Ÿ", lat: 22.9616, lng: 120.3275 },
            { name: "å®˜ç”°å€å…¬æ‰€", addr: "720è‡ºå—å¸‚å®˜ç”°å€ä¸­å±±è·¯ä¸€æ®µ132è™Ÿ", lat: 23.1843, lng: 120.3117 },
            { name: "éº»è±†å€å…¬æ‰€", addr: "721è‡ºå—å¸‚éº»è±†å€å¿ å­è·¯250è™Ÿ", lat: 23.1860, lng: 120.2476 },
            { name: "ä½³é‡Œå€å…¬æ‰€", addr: "722è‡ºå—å¸‚ä½³é‡Œå€å¿ å­è·¯5è™Ÿ", lat: 23.1673, lng: 120.1773 },
            { name: "æ–°ç‡Ÿå€å…¬æ‰€", addr: "730è‡ºå—å¸‚æ–°ç‡Ÿå€ä¸­æ­£è·¯30è™Ÿ", lat: 23.3073, lng: 120.3150 },
            { name: "å–„åŒ–å€å…¬æ‰€", addr: "741è‡ºå—å¸‚å–„åŒ–å€å»ºåœ‹è·¯190è™Ÿ", lat: 23.1323, lng: 120.2965 },
            { name: "æ–°å¸‚å€å…¬æ‰€", addr: "744è‡ºå—å¸‚æ–°å¸‚å€ä¸­èˆˆè¡—12è™Ÿ", lat: 23.0788, lng: 120.2952 },
        ],
        "é«˜é›„å¸‚": [
            { name: "æ——å±±å€å…¬æ‰€", addr: "842é«˜é›„å¸‚æ——å±±å€å»¶å¹³ä¸€è·¯499è™Ÿ", lat: 22.8885, lng: 120.4826 },
            { name: "ç¾æ¿ƒå€å…¬æ‰€", addr: "843é«˜é›„å¸‚ç¾æ¿ƒå€ç¾ä¸­è·¯260è™Ÿ", lat: 22.9156, lng: 120.5428 },
            { name: "é³³å±±å€å…¬æ‰€", addr: "830é«˜é›„å¸‚é³³å±±å€ç¶“æ­¦è·¯30è™Ÿ", lat: 22.6253, lng: 120.3661 },
            { name: "è‹“é›…å€å…¬æ‰€", addr: "802é«˜é›„å¸‚è‹“é›…å€æ°‘æ¬Šä¸€è·¯85è™Ÿ", lat: 22.6224, lng: 120.3118 },
            { name: "ä¸‰æ°‘å€å…¬æ‰€", addr: "807é«˜é›„å¸‚ä¸‰æ°‘å€å“ˆçˆ¾æ¿±è¡—215è™Ÿ", lat: 22.6433, lng: 120.3155 },
            { name: "å·¦ç‡Ÿå€å…¬æ‰€", addr: "813é«˜é›„å¸‚å·¦ç‡Ÿå€å·¦ç‡Ÿå¤§è·¯479è™Ÿ", lat: 22.6896, lng: 120.3094 },
            { name: "æ¥ æ¢“å€å…¬æ‰€", addr: "811é«˜é›„å¸‚æ¥ æ¢“å€æ¥ æ¢“æ–°è·¯264è™Ÿ", lat: 22.7291, lng: 120.3270 },
            { name: "å°æ¸¯å€å…¬æ‰€", addr: "812é«˜é›„å¸‚å°æ¸¯å€å°æ¸¯è·¯158è™Ÿ", lat: 22.5651, lng: 120.3534 },
            { name: "é¼“å±±å€å…¬æ‰€", addr: "804é«˜é›„å¸‚é¼“å±±å€é¼“å±±äºŒè·¯166è™Ÿ", lat: 22.6264, lng: 120.2764 },
            { name: "æ–°èˆˆå€å…¬æ‰€", addr: "800é«˜é›„å¸‚æ–°èˆˆå€ä¸­æ­£ä¸‰è·¯34è™Ÿ", lat: 22.6288, lng: 120.3053 },
            { name: "å‰é‡‘å€å…¬æ‰€", addr: "801é«˜é›„å¸‚å‰é‡‘å€è‡ªå¼·äºŒè·¯1è™Ÿ", lat: 22.6277, lng: 120.2941 },
            { name: "é¹½åŸ•å€å…¬æ‰€", addr: "803é«˜é›„å¸‚é¹½åŸ•å€å¤§ä»è·¯79è™Ÿ", lat: 22.6247, lng: 120.2863 },
            { name: "å‰é®å€å…¬æ‰€", addr: "806é«˜é›„å¸‚å‰é®å€åº·å®šè·¯151è™Ÿ", lat: 22.5864, lng: 120.3184 },
            { name: "æ——æ´¥å€å…¬æ‰€", addr: "805é«˜é›„å¸‚æ——æ´¥å€æ——æ´¥ä¸‰è·¯2è™Ÿ", lat: 22.5899, lng: 120.2786 },
            { name: "å¤§å¯®å€å…¬æ‰€", addr: "831é«˜é›„å¸‚å¤§å¯®å€é³³æ—ä¸‰è·¯375è™Ÿ", lat: 22.6053, lng: 120.3965 },
            { name: "æ—åœ’å€å…¬æ‰€", addr: "832é«˜é›„å¸‚æ—åœ’å€ç‹å…¬è·¯1è™Ÿ", lat: 22.5050, lng: 120.3957 },
            { name: "ä»æ­¦å€å…¬æ‰€", addr: "814é«˜é›„å¸‚ä»æ­¦å€ä¸­æ­£è·¯135è™Ÿ", lat: 22.6983, lng: 120.3475 },
            { name: "å²¡å±±å€å…¬æ‰€", addr: "820é«˜é›„å¸‚å²¡å±±å€å²¡å±±è·¯343è™Ÿ", lat: 22.7960, lng: 120.2960 },
            { name: "è·¯ç«¹å€å…¬æ‰€", addr: "821é«˜é›„å¸‚è·¯ç«¹å€åœ‹æ˜Œè·¯76è™Ÿ", lat: 22.8550, lng: 120.2618 },
        ],
        "è‡ºåŒ—å¸‚": [
            { name: "ä¿¡ç¾©å€å…¬æ‰€", addr: "110è‡ºåŒ—å¸‚ä¿¡ç¾©å€ç¦å¾·è¡—86è™Ÿ", lat: 25.0375, lng: 121.5802 },
            { name: "ä¸­æ­£å€å…¬æ‰€", addr: "100è‡ºåŒ—å¸‚ä¸­æ­£å€å¿ å­æ±è·¯ä¸€æ®µ108è™Ÿ", lat: 25.0440, lng: 121.5233 },
            { name: "å¤§åŒå€å…¬æ‰€", addr: "103è‡ºåŒ—å¸‚å¤§åŒå€æ˜Œå‰è¡—57è™Ÿ", lat: 25.0645, lng: 121.5134 },
            { name: "ä¸­å±±å€å…¬æ‰€", addr: "104è‡ºåŒ—å¸‚ä¸­å±±å€æ¾æ±Ÿè·¯367è™Ÿ", lat: 25.0634, lng: 121.5332 },
            { name: "æ¾å±±å€å…¬æ‰€", addr: "105è‡ºåŒ—å¸‚æ¾å±±å€å…«å¾·è·¯å››æ®µ692è™Ÿ", lat: 25.0503, lng: 121.5776 },
            { name: "å¤§å®‰å€å…¬æ‰€", addr: "106è‡ºåŒ—å¸‚å¤§å®‰å€æ–°ç”Ÿå—è·¯äºŒæ®µ86è™Ÿ", lat: 25.0263, lng: 121.5364 },
            { name: "è¬è¯å€å…¬æ‰€", addr: "108è‡ºåŒ—å¸‚è¬è¯å€å’Œå¹³è¥¿è·¯ä¸‰æ®µ120è™Ÿ", lat: 25.0337, lng: 121.4965 },
            { name: "å£«æ—å€å…¬æ‰€", addr: "111è‡ºåŒ—å¸‚å£«æ—å€ä¸­æ­£è·¯439è™Ÿ", lat: 25.0935, lng: 121.5255 },
            { name: "åŒ—æŠ•å€å…¬æ‰€", addr: "112è‡ºåŒ—å¸‚åŒ—æŠ•å€æ–°å¸‚è¡—30è™Ÿ", lat: 25.1320, lng: 121.4986 },
            { name: "å…§æ¹–å€å…¬æ‰€", addr: "114è‡ºåŒ—å¸‚å…§æ¹–å€æ°‘æ¬Šæ±è·¯å…­æ®µ99è™Ÿ", lat: 25.0689, lng: 121.5909 },
            { name: "å—æ¸¯å€å…¬æ‰€", addr: "115è‡ºåŒ—å¸‚å—æ¸¯å€å—æ¸¯è·¯ä¸€æ®µ360è™Ÿ", lat: 25.0543, lng: 121.6074 },
            { name: "æ–‡å±±å€å…¬æ‰€", addr: "116è‡ºåŒ—å¸‚æ–‡å±±å€æœ¨æŸµè·¯ä¸‰æ®µ220è™Ÿ", lat: 24.9928, lng: 121.5701 },
        ],
        "æ–°åŒ—å¸‚": [
            { name: "æ¿æ©‹å€å…¬æ‰€", addr: "220æ–°åŒ—å¸‚æ¿æ©‹å€åºœä¸­è·¯30è™Ÿ", lat: 25.0094, lng: 121.4594 },
            { name: "æ–°èŠå€å…¬æ‰€", addr: "242æ–°åŒ—å¸‚æ–°èŠå€ä¸­å¹³è·¯133è™Ÿ", lat: 25.0450, lng: 121.4467 },
            { name: "ä¸‰é‡å€å…¬æ‰€", addr: "241æ–°åŒ—å¸‚ä¸‰é‡å€æ–°åŒ—å¤§é“ä¸€æ®µ11è™Ÿ", lat: 25.0607, lng: 121.4883 },
            { name: "ä¸­å’Œå€å…¬æ‰€", addr: "235æ–°åŒ—å¸‚ä¸­å’Œå€æ™¯å¹³è·¯634-2è™Ÿ", lat: 25.0006, lng: 121.4998 },
            { name: "æ°¸å’Œå€å…¬æ‰€", addr: "234æ–°åŒ—å¸‚æ°¸å’Œå€ç«¹æ—è·¯200è™Ÿ", lat: 25.0115, lng: 121.5150 },
            { name: "æ–°åº—å€å…¬æ‰€", addr: "231æ–°åŒ—å¸‚æ–°åº—å€åŒ—æ–°è·¯ä¸€æ®µ86è™Ÿ", lat: 24.9681, lng: 121.5414 },
            { name: "åœŸåŸå€å…¬æ‰€", addr: "236æ–°åŒ—å¸‚åœŸåŸå€é‡‘åŸè·¯ä¸€æ®µ101è™Ÿ", lat: 24.9723, lng: 121.4443 },
            { name: "è˜†æ´²å€å…¬æ‰€", addr: "247æ–°åŒ—å¸‚è˜†æ´²å€ä¸‰æ°‘è·¯95è™Ÿ", lat: 25.0864, lng: 121.4746 },
            { name: "æ±æ­¢å€å…¬æ‰€", addr: "221æ–°åŒ—å¸‚æ±æ­¢å€æ–°å°äº”è·¯ä¸€æ®µ268è™Ÿ", lat: 25.0664, lng: 121.6575 },
            { name: "æ¨¹æ—å€å…¬æ‰€", addr: "238æ–°åŒ—å¸‚æ¨¹æ—å€é®å‰è¡—93è™Ÿ", lat: 24.9922, lng: 121.4190 },
            { name: "æ·¡æ°´å€å…¬æ‰€", addr: "251æ–°åŒ—å¸‚æ·¡æ°´å€ä¸­å±±åŒ—è·¯äºŒæ®µ375è™Ÿ", lat: 25.1818, lng: 121.4397 },
        ],
        "è‡ºä¸­å¸‚": [
            { name: "è¥¿å±¯å€å…¬æ‰€", addr: "407è‡ºä¸­å¸‚è¥¿å±¯å€å¸‚æ”¿åŒ—äºŒè·¯386è™Ÿ", lat: 24.1593, lng: 120.6366 },
            { name: "åŒ—å±¯å€å…¬æ‰€", addr: "406è‡ºä¸­å¸‚åŒ—å±¯å€å´‡å¾·è·¯ä¸‰æ®µ10è™Ÿ", lat: 24.1804, lng: 120.6888 },
            { name: "å—å±¯å€å…¬æ‰€", addr: "408è‡ºä¸­å¸‚å—å±¯å€æ°¸æ˜¥æ±è·¯679è™Ÿ", lat: 24.1384, lng: 120.6409 },
            { name: "è±åŸå€å…¬æ‰€", addr: "420è‡ºä¸­å¸‚è±åŸå€å¸‚æ”¿è·¯2è™Ÿ", lat: 24.2530, lng: 120.7203 },
            { name: "å¤§é‡Œå€å…¬æ‰€", addr: "412è‡ºä¸­å¸‚å¤§é‡Œå€å¤§æ–°è¡—36è™Ÿ", lat: 24.0995, lng: 120.6775 },
            { name: "å¤ªå¹³å€å…¬æ‰€", addr: "411è‡ºä¸­å¸‚å¤ªå¹³å€ä¸­å¹³è·¯144è™Ÿ", lat: 24.1258, lng: 120.7161 },
            { name: "æ²™é¹¿å€å…¬æ‰€", addr: "433è‡ºä¸­å¸‚æ²™é¹¿å€é®æ”¿è·¯8è™Ÿ", lat: 24.2341, lng: 120.5583 },
            { name: "ä¸­å€å€å…¬æ‰€", addr: "400è‡ºä¸­å¸‚ä¸­å€æˆåŠŸè·¯300è™Ÿ", lat: 24.1404, lng: 120.6817 },
        ],
        "æ¡ƒåœ’å¸‚": [
            { name: "æ¡ƒåœ’å€å…¬æ‰€", addr: "330æ¡ƒåœ’å¸‚æ¡ƒåœ’å€ç¸£åºœè·¯7è™Ÿ", lat: 24.9936, lng: 121.3009 },
            { name: "ä¸­å£¢å€å…¬æ‰€", addr: "320æ¡ƒåœ’å¸‚ä¸­å£¢å€ç’°åŒ—è·¯380è™Ÿ", lat: 24.9653, lng: 121.2255 },
            { name: "å¹³é®å€å…¬æ‰€", addr: "324æ¡ƒåœ’å¸‚å¹³é®å€æŒ¯èˆˆè·¯5è™Ÿ", lat: 24.9436, lng: 121.2132 },
            { name: "å…«å¾·å€å…¬æ‰€", addr: "334æ¡ƒåœ’å¸‚å…«å¾·å€ä¸­å±±è·¯47è™Ÿ", lat: 24.9287, lng: 121.2845 },
            { name: "æ¥Šæ¢…å€å…¬æ‰€", addr: "326æ¡ƒåœ’å¸‚æ¥Šæ¢…å€å¤§æˆè·¯2è™Ÿ", lat: 24.9148, lng: 121.1458 },
            { name: "é¾œå±±å€å…¬æ‰€", addr: "333æ¡ƒåœ’å¸‚é¾œå±±å€ä¸­å±±è¡—26è™Ÿ", lat: 24.9961, lng: 121.3516 },
            { name: "è˜†ç«¹å€å…¬æ‰€", addr: "338æ¡ƒåœ’å¸‚è˜†ç«¹å€å—å´è·¯150è™Ÿ", lat: 25.0503, lng: 121.2908 },
        ],
        "å„ç¸£å¸‚ç²¾é¸": [
            { name: "æ–°ç«¹å¸‚æ±å€å€å…¬æ‰€", addr: "300æ–°ç«¹å¸‚æ±å€æ°‘æ—è·¯40è™Ÿ", lat: 24.8073, lng: 120.9856 },
            { name: "ç«¹åŒ—å¸‚å…¬æ‰€", addr: "302æ–°ç«¹ç¸£ç«¹åŒ—å¸‚ä¸­æ­£è¥¿è·¯50è™Ÿ", lat: 24.8396, lng: 121.0097 },
            { name: "è‹—æ —å¸‚å…¬æ‰€", addr: "360è‹—æ —ç¸£è‹—æ —å¸‚åºœå‰è·¯76è™Ÿ", lat: 24.5694, lng: 120.8208 },
            { name: "å½°åŒ–å¸‚å…¬æ‰€", addr: "500å½°åŒ–ç¸£å½°åŒ–å¸‚å…‰å¾©è·¯74è™Ÿ", lat: 24.0814, lng: 120.5385 },
            { name: "å—æŠ•å¸‚å…¬æ‰€", addr: "540å—æŠ•ç¸£å—æŠ•å¸‚ç‰äº•è¡—5è™Ÿ", lat: 23.9103, lng: 120.6860 },
            { name: "é›²æ—ç¸£æ–—å…­å¸‚å…¬æ‰€", addr: "640é›²æ—ç¸£æ–—å…­å¸‚åºœæ–‡è·¯38è™Ÿ", lat: 23.7093, lng: 120.5434 },
            { name: "å˜‰ç¾©å¸‚æ±å€å€å…¬æ‰€", addr: "600å˜‰ç¾©å¸‚æ±å€å³é³³åŒ—è·¯184è™Ÿ", lat: 23.4862, lng: 120.4633 },
            { name: "å˜‰ç¾©ç¸£å¤ªä¿å¸‚å…¬æ‰€", addr: "612å˜‰ç¾©ç¸£å¤ªä¿å¸‚å¤ªä¿é‡Œ36è™Ÿ", lat: 23.4593, lng: 120.3323 },
            { name: "å±æ±å¸‚å…¬æ‰€", addr: "900å±æ±ç¸£å±æ±å¸‚å°ç³–è¡—61è™Ÿ", lat: 22.6771, lng: 120.5042 },
            { name: "å®œè˜­å¸‚å…¬æ‰€", addr: "260å®œè˜­ç¸£å®œè˜­å¸‚ä¸­å±±è·¯äºŒæ®µ432è™Ÿ", lat: 24.7570, lng: 121.7530 },
            { name: "èŠ±è“®å¸‚å…¬æ‰€", addr: "970èŠ±è“®ç¸£èŠ±è“®å¸‚æ—æ£®è·¯252è™Ÿ", lat: 23.9772, lng: 121.6046 },
            { name: "è‡ºæ±å¸‚å…¬æ‰€", addr: "950è‡ºæ±ç¸£è‡ºæ±å¸‚åšæ„›è·¯365è™Ÿ", lat: 22.7561, lng: 121.1506 }
        ]
    };
    
    // è£œå……: é€šç”¨è¡Œæ”¿å€
    const genericDistricts = {
         "åŸºéš†å¸‚": { "ä»æ„›å€": [25.1287, 121.7423], "ä¿¡ç¾©å€": [25.1257, 121.7726], "ä¸­æ­£å€": [25.1436, 121.7783] },
         "æ–°ç«¹ç¸£": { "ç«¹æ±é®": [24.7381, 121.0924], "æ¹–å£é„‰": [24.9038, 121.0435] },
         "å½°åŒ–ç¸£": { "é¹¿æ¸¯é®": [24.0560, 120.4350], "å“¡æ—å¸‚": [23.9592, 120.5701] },
         "å˜‰ç¾©ç¸£": { "æ°‘é›„é„‰": [23.5515, 120.4285] },
         "å±æ±ç¸£": { "æ½®å·é®": [22.5505, 120.5422], "æ±æ¸¯é®": [22.4678, 120.4529], "æ†æ˜¥é®": [22.0028, 120.7454] },
         "å®œè˜­ç¸£": { "ç¾…æ±é®": [24.6750, 121.7669], "ç¤æºªé„‰": [24.8234, 121.7702] },
    };

    // --- 2. ç¨‹å¼é‚è¼¯ ---
    const originAddr = "842é«˜é›„å¸‚æ——å±±å€æ——å—ä¸‰è·¯234è™Ÿ";
    const startLat = 22.8028; 
    const startLng = 120.4566;
    
    const map = L.map('map').setView([23.5, 121], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const startMarker = L.marker([startLat, startLng], {icon: L.divIcon({className: 'custom-icon', html: 'ğŸš©', iconSize: [30, 30]})}).addTo(map)
        .bindPopup(`<b>ğŸš© ç‡Ÿå€ (å‡ºç™¼åœ°)</b><br>${originAddr}`).openPopup();

    let routeLayer = null;
    let endMarker = null;

    // --- 3. å¡«å……é¸å–® ---
    const select = document.getElementById('district-select');
    
    for (const [city, districts] of Object.entries(districtData)) {
        const group = document.createElement('optgroup');
        group.label = city;
        districts.forEach(d => {
            const option = document.createElement('option');
            option.value = JSON.stringify({lat: d.lat, lng: d.lng, addr: d.addr, name: city + d.name});
            option.text = `${city}${d.name}`;
            group.appendChild(option);
        });
        select.appendChild(group);
    }
    
    for (const [city, districts] of Object.entries(genericDistricts)) {
        const group = document.createElement('optgroup');
        group.label = city + " (é€šç”¨åº§æ¨™)";
        for (const [name, coords] of Object.entries(districts)) {
            const option = document.createElement('option');
            const addrPlaceholder = `${city}${name}å…¬æ‰€`;
            option.value = JSON.stringify({lat: coords[0], lng: coords[1], addr: addrPlaceholder, name: city + name});
            option.text = `${city}${name}`;
            group.appendChild(option);
        }
        select.appendChild(group);
    }

    let tomSelectInstance = new TomSelect('#district-select', {
        create: false,
        sortField: { field: "text", direction: "asc" },
        placeholder: "è¼¸å…¥æˆ¶ç±åœ°å€ (ä¾‹å¦‚: æ°¸åº·)..."
    });

    // --- 4. è¨ˆç®—è·¯å¾‘èˆ‡ Google Link ç”¢ç”Ÿ ---
    async function calculateRoute() {
        const resultCard = document.getElementById('result-card');
        const resultContent = document.getElementById('result-content');
        const selectedValue = select.value;

        if (!selectedValue) {
            alert("è«‹å…ˆè¼¸å…¥æ‚¨çš„æˆ¶ç±åœ° (å€å…¬æ‰€)ï¼");
            tomSelectInstance.focus();
            return;
        }

        const destData = JSON.parse(selectedValue);
        const endLat = destData.lat;
        const endLng = destData.lng;
        
        resultCard.style.display = 'block';
        resultContent.innerHTML = "<div style='padding:15px; text-align:center;'>â³ æ­£åœ¨é ä¼°è·é›¢èˆ‡é‡‘é¡...</div>";

        // OSRM API (ç”¨æ–¼ç¶²é å¿«é€Ÿé è¦½)
        const osrmUrl = `https://router.project-osrm.org/route/v1/driving/${startLng},${startLat};${endLng},${endLat}?overview=full&geometries=geojson`;

        // ç”¢ç”Ÿ Google Maps é€£çµ (Official)
        // ä½¿ç”¨ encodeURIComponent ç¢ºä¿ä¸­æ–‡åœ°å€ä¸æœƒäº‚ç¢¼
        const googleMapsUrl = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(originAddr)}&destination=${encodeURIComponent(destData.addr)}&travelmode=driving`;

        try {
            const response = await fetch(osrmUrl);
            const data = await response.json();

            if (data.code !== 'Ok') {
                resultContent.innerHTML = "<div style='padding:15px;'>ç„¡æ³•è¦åŠƒè·¯å¾‘ã€‚</div>";
                return;
            }

            const route = data.routes[0];
            const distanceKm = (route.distance / 1000).toFixed(1); // å…¬é‡Œæ•¸
            
            // æ—…è²»è¨ˆç®—
            let money = 0;
            let ruleDesc = "";
            let moneyClass = "";
            
            if (parseFloat(distanceKm) >= 60) {
                money = 600;
                ruleDesc = "(ç³»çµ±ä¼°ç®— â‰¥ 60km)";
            } else {
                money = 200;
                ruleDesc = "(ç³»çµ±ä¼°ç®— < 60km)";
            }

            // é¡¯ç¤ºçµæœ
            resultContent.innerHTML = `
                <div class="result-header">
                    <div class="result-row"><span class="result-label">ç›®çš„åœ°ï¼š</span><b>${destData.name}</b></div>
                    <div class="result-row"><span class="result-label">åœ°å€ï¼š</span><span class="result-address">${destData.addr}</span></div>
                </div>
                <div class="result-body">
                    <div class="result-row"><span class="result-label">é ä¼°è·é›¢ï¼š</span><span class="highlight-dist">${distanceKm}</span> å…¬é‡Œ</div>
                    
                    <div class="money-box">
                        <div class="money-title">ğŸ’° ç³»çµ±é ç®—é‡‘é¡</div>
                        <div class="money-amount">NT$ ${money}</div>
                        <div class="money-note">${ruleDesc}</div>
                    </div>

                    <a href="${googleMapsUrl}" target="_blank" class="btn-gmaps">
                        ğŸ—ºï¸ é–‹å•Ÿ Google Maps é©—è­‰ (ä¾›æˆªåœ–æ ¸éŠ·)
                    </a>
                </div>
            `;

            if (routeLayer) map.removeLayer(routeLayer);
            if (endMarker) map.removeLayer(endMarker);

            routeLayer = L.geoJSON(route.geometry, {
                style: { color: '#198754', weight: 6, opacity: 0.8 }
            }).addTo(map);

            endMarker = L.marker([endLat, endLng], {icon: L.divIcon({className: 'custom-icon', html: 'ğŸ ', iconSize: [30, 30]})}).addTo(map)
                .bindPopup(`<b>ğŸ æˆ¶ç±åœ°</b><br>${destData.addr}`).openPopup();

            map.fitBounds(routeLayer.getBounds(), { padding: [50, 50] });

        } catch (error) {
            console.error(error);
            resultContent.innerHTML = "<div style='padding:15px; color:red;'>âš ï¸ é€£ç·šéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ç‹€æ…‹ã€‚</div>";
        }
    }
</script>

</body>
</html>
